---
import "@styles/global.css";
import Footer from "@components/Footer.astro";
import Header from '../components/Header.jsx';
import GlobalToaster from '../components/GlobalToaster.jsx';
import { isUserAdmin } from '../lib/auth.js';

export interface Props {
  cartCount?: number;
  title?: string;
  currentLocale?: string;
}

const { title, currentLocale } = Astro.props;
const pathname = Astro.url.pathname;

// Verificar si el usuario es admin en el servidor (evita flash en Header)
const isAdmin = await isUserAdmin(Astro.request);
---
<!DOCTYPE html>
<html lang={currentLocale}>
  <head>
    <meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon_roots.webp" />
		<title>{title}</title>
		<!-- Inyectar estado inicial para evitar flash en componentes React -->
		<script define:vars={{ isAdmin }}>
			window.__ROOTS_INITIAL_STATE__ = { isAdmin };
		</script>
  </head>
  <body class="min-h-screen flex flex-col">
		<Header client:only />

    <!-- Contenido principal con margen top para el header fijo -->
    <main class="flex-1 p-2 pt-24">
      <slot />
    </main>	

    <!-- Footer opcional -->
    <Footer class="bg-gray-800 text-white py-4" />

    <!-- Toast notifications global -->
    <GlobalToaster client:only="react" />
  </body>
</html>
<style is:global>
	:root {
		/* B2B Brand tokens â€” warm workshop palette */
		--roots-sand: #f5f0eb;
		--roots-stone: #e8e2db;
		--roots-bark: #3d3428;
		--roots-earth: #5c4f3d;
		--roots-clay: #8b7355;
		--roots-moss: #6b7c5e;
		--roots-warm-white: #faf7f4;
		--roots-border: rgba(61, 52, 40, 0.08);
		--roots-border-strong: rgba(61, 52, 40, 0.15);
	}
	html {
		font-family: "Figtree Variable", system-ui, sans-serif;
		background: var(--roots-sand);
		color: var(--roots-bark);
	}
	code {
		font-family:
			"Figtree Variable",
			system-ui,
			monospace;
	}
	body {
		display: flex;
		flex-direction: column;
		min-height: 100vh;
		width: 100%;
		margin: 0;
	}
</style>
